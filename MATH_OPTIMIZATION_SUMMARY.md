# 数学公式网页显示优化总结

## 问题描述
原始网页中的数学公式显示效果不佳，与Obsidian中的显示效果相比存在以下问题：
- 公式间距不合理
- 字体渲染不一致
- 缺乏响应式设计
- 没有暗色模式支持
- 对齐和可读性差

## 解决方案

### 1. 切换到MathJax渲染器
**文件**: `hugo.toml`
- 从KaTeX切换到MathJax 3.2.2
- 配置内联数学公式分隔符: `$...$` 和 `\(...\)`
- 配置显示数学公式分隔符: `$$...$$` 和 `\[...\]`
- 启用转义字符处理和数学环境

### 2. 创建自定义CSS样式
**文件**: `static/css/math-enhancement.css`
主要改进：
- **更好的间距**: 增加数学公式周围的边距和内边距
- **增强的排版**: 改进字体渲染和行高
- **响应式设计**: 数学公式在移动设备上正确缩放
- **暗色模式支持**: 为明暗主题提供适当的样式
- **公式编号**: 为显示数学公式自动编号
- **视觉容器**: 数学块具有边框和背景的独特样式

### 3. 自定义头部配置
**文件**: `layouts/partials/extend_head.html`
- MathJax配置和加载
- 自定义字体加载（Source Serif Pro用于数学，Source Code Pro用于代码）
- 自定义CSS加载

### 4. 字体优化
- **数学字体**: Source Serif Pro，提供更好的数学可读性
- **代码字体**: Source Code Pro，用于代码块
- **行高**: 改进间距以提高可读性
- **响应式大小**: 数学公式在不同屏幕尺寸上适当缩放

## 主要特性

### 内联数学公式
- 内联公式周围的适当间距
- 背景高亮以提高可见性
- 响应式字体大小

### 显示数学公式
- 居中对齐
- 自动编号
- 带边框的视觉容器
- 与周围文本的更好间距

### 响应式设计
- **桌面**: 全尺寸数学公式，最佳间距
- **平板**: 略微减小字体大小以适应
- **移动**: 紧凑显示，保持可读性

### 暗色模式支持
- 暗色主题中的适当颜色对比
- 跨主题的一致样式
- 增强的可见性

## 使用方法

### 编写数学公式

**内联数学**: 使用单美元符号
```markdown
公式 $E = mc^2$ 很有名。
```

**显示数学**: 使用双美元符号
```markdown
$$P(k) = \frac{\text{Number of nodes with degree } k}{n}$$
```

**数学容器**: 用于复杂公式
```markdown
<div class="math-container">
$$Q = \frac{1}{2m} \sum_{ij} \left[ A_{ij} - \frac{k_i k_j}{2m} \right] \delta(c_i, c_j)$$
</div>
```

## 测试页面
- `content/posts/math-test.md` - 完整的数学公式测试
- `content/posts/math-quick-test.md` - 快速测试页面

## 浏览器支持
- **Chrome**: 完全支持
- **Firefox**: 完全支持
- **Safari**: 完全支持
- **Edge**: 完全支持
- **移动浏览器**: 响应式设计

## 性能优化
- **MathJax 3.2.2**: 最新版本，性能改进
- **延迟加载**: 数学公式在页面内容后加载
- **CDN交付**: 从jsdelivr.net快速加载
- **缓存**: 重复访问的浏览器缓存

## 维护说明
要更新数学渲染：
1. 修改 `static/css/math-enhancement.css` 进行样式更改
2. 更新 `hugo.toml` 进行MathJax配置更改
3. 使用测试页面验证更改
4. 在不同浏览器和设备上验证

## 结果
现在网页中的数学公式显示效果应该与Obsidian中的显示效果相当，甚至更好，具有：
- 更好的间距和对齐
- 一致的字体渲染
- 响应式设计
- 暗色模式支持
- 增强的可读性
